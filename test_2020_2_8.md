
# 第四天——Numpy_2

#### 布尔索引


```python
import numpy as np
```


```python
name = np.array(['a','b','a','c'])
```


```python
name == 'a'
```




    array([ True, False,  True, False])




```python
ary = np.eye(4)*(np.arange(4)+1)
ary
```




    array([[1., 0., 0., 0.],
           [0., 2., 0., 0.],
           [0., 0., 3., 0.],
           [0., 0., 0., 4.]])




```python
ary[name == 'a']
```




    array([[1., 0., 0., 0.],
           [0., 0., 3., 0.]])




```python
ary[name == 'a',name == 'a'] #取了【0.0】和【2，2】
```




    array([1., 3.])




```python
ary[name == 'a',~(name == 'a')] #取了【0.1】和【2，3】
```




    array([0., 0.])



#### 神奇索引/花式索引（fancy index）


```python
ary1 = np.arange(32).reshape((8,4))
ary1
```




    array([[ 0,  1,  2,  3],
           [ 4,  5,  6,  7],
           [ 8,  9, 10, 11],
           [12, 13, 14, 15],
           [16, 17, 18, 19],
           [20, 21, 22, 23],
           [24, 25, 26, 27],
           [28, 29, 30, 31]])



以指定的序列来选择指定的行子集。


```python
ary1[[1,5,7,2]]
```




    array([[ 4,  5,  6,  7],
           [20, 21, 22, 23],
           [28, 29, 30, 31],
           [ 8,  9, 10, 11]])




```python
ary1[[1,5,7,2],[0,3,1,2]] #输出一维
```




    array([ 4, 23, 29, 10])




```python
ary1[[1,5,7,2]][[0,3,1,2]] #对行进行了两次排序
```




    array([[ 4,  5,  6,  7],
           [ 8,  9, 10, 11],
           [20, 21, 22, 23],
           [28, 29, 30, 31]])




```python
ary1[[1,5,7,2]][:,[0,3,1,2]] #对行排序后再对列排序
```




    array([[ 4,  7,  5,  6],
           [20, 23, 21, 22],
           [28, 31, 29, 30],
           [ 8, 11,  9, 10]])



花式和切片不同，花式把数组复制出来，对原数组没有影响。


```python
a = ary1[[1,5,7,2]][:,[0,3,1,2]]
a
```




    array([[ 4,  7,  5,  6],
           [20, 23, 21, 22],
           [28, 31, 29, 30],
           [ 8, 11,  9, 10]])




```python
a[0][0]  = 111111
a
```




    array([[111111,      7,      5,      6],
           [    20,     23,     21,     22],
           [    28,     31,     29,     30],
           [     8,     11,      9,     10]])




```python
ary1
```




    array([[ 0,  1,  2,  3],
           [ 4,  5,  6,  7],
           [ 8,  9, 10, 11],
           [12, 13, 14, 15],
           [16, 17, 18, 19],
           [20, 21, 22, 23],
           [24, 25, 26, 27],
           [28, 29, 30, 31]])



#### 转置，轴变换，点积


```python
ary2 = np.arange(15).reshape(3,5)
ary2
```




    array([[ 0,  1,  2,  3,  4],
           [ 5,  6,  7,  8,  9],
           [10, 11, 12, 13, 14]])



##### 转置


```python
ary2.T #转置
```




    array([[ 0,  5, 10],
           [ 1,  6, 11],
           [ 2,  7, 12],
           [ 3,  8, 13],
           [ 4,  9, 14]])



对转置进行改动并会影响原数组(不是复制而是引用)


```python
a = ary2.T
a[0][0] = 1
ary2
```




    array([[ 1,  1,  2,  3,  4],
           [ 5,  6,  7,  8,  9],
           [10, 11, 12, 13, 14]])



##### 点乘，内积


```python
np.dot(ary2.T,ary2) # 5*3 * 3*5 = 5*5  #点乘
```




    array([[126, 141, 157, 173, 189],
           [141, 158, 176, 194, 212],
           [157, 176, 197, 218, 239],
           [173, 194, 218, 242, 266],
           [189, 212, 239, 266, 293]])




```python
np.dot(ary2,ary2.T)
```




    array([[ 31,  85, 140],
           [ 85, 255, 430],
           [140, 430, 730]])



##### 高维转轴


```python
ary3 = np.arange(16).reshape((2,2,4))
ary3
```




    array([[[ 0,  1,  2,  3],
            [ 4,  5,  6,  7]],
    
           [[ 8,  9, 10, 11],
            [12, 13, 14, 15]]])




```python
ary3.transpose((2,1,0))
```




    array([[[ 0,  8],
            [ 4, 12]],
    
           [[ 1,  9],
            [ 5, 13]],
    
           [[ 2, 10],
            [ 6, 14]],
    
           [[ 3, 11],
            [ 7, 15]]])




```python
#transpose改变了所有元素的维度顺序,现象为单个元素索引顺序的变换
#维度由原本的（2，2，4）变为了（4，2，2）
#以变换后的2 ，6 ，10 ，14 元素为例
#2 的原本索引为[0][0][2]
#6 的原本索引为[0][1][2]
#10 的原本索引为[1][0][2]
#14的原本索引为[1][1][2]
#索引对应的序列（元组）为(0,1,2)
#变换后对应的序列（元组）为(2,1,0)
#即
#2  为[2][0][0]
#6  为[2][1][0]
#10 为[2][0][1]
#14 为[2][1][1]
```


```python
ary3.swapaxes(1,2)#等价于 ary3.transpose((0,2,1)) 即调换1和2轴 
```




    array([[[ 0,  4],
            [ 1,  5],
            [ 2,  6],
            [ 3,  7]],
    
           [[ 8, 12],
            [ 9, 13],
            [10, 14],
            [11, 15]]])



## 4.2 通用函数

通用函数(ufunc)是对ndarray中的数据执行元素级运算的函数，即简单函数的矢量化包装器。

### 一元函数


```python
ary3 = np.arange(10)
```




    array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])




```python
np.sqrt(ary3) #求根 #复制，不影响原数组
```




    array([0.        , 1.        , 1.41421356, 1.73205081, 2.        ,
           2.23606798, 2.44948974, 2.64575131, 2.82842712, 3.        ])




```python
np.exp(ary3) #求e幂 #复制，不影响原数组
```




    array([1.00000000e+00, 2.71828183e+00, 7.38905610e+00, 2.00855369e+01,
           5.45981500e+01, 1.48413159e+02, 4.03428793e+02, 1.09663316e+03,
           2.98095799e+03, 8.10308393e+03])



### 二元函数


```python
x = np.random.randn(8)
print(x)
y = np.random.randn(8)
print(y)
np.maximum(x,y)   ##比较两者对应元素输出最大
```

    [-0.45482598 -0.24620985 -0.23178343 -1.00583908  0.70068003 -0.05544378
      0.0485544   1.25047046]
    [-0.3532592   2.35790173 -0.51578777 -0.08477719  0.40038852 -0.00283001
      1.24624056 -0.42273641]
    




    array([-0.3532592 ,  2.35790173, -0.23178343, -0.08477719,  0.70068003,
           -0.00283001,  1.24624056,  1.25047046])



### 返回多个数组


```python
ary4 = np.random.randn(8)*5
print(ary4)
r,w = np.modf(ary4)   #输出左小数，右整数
print(r)
print(w)
```

    [-4.05420848 -2.97427608 -2.71318553 -0.43836468  0.27098488  0.98397091
     10.56061116 -2.90033833]
    [-0.05420848 -0.97427608 -0.71318553 -0.43836468  0.27098488  0.98397091
      0.56061116 -0.90033833]
    [-4. -2. -2. -0.  0.  0. 10. -2.]
    

### 可接受out选项参数


```python
ary5 = np.random.randn(8)
np.sqrt(ary5,ary5)
```

    D:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64\lib\site-packages\ipykernel_launcher.py:2: RuntimeWarning: invalid value encountered in sqrt
      
    




    array([       nan, 0.17480546, 0.92714985,        nan, 0.7494462 ,
           0.64813177, 1.6873242 , 1.04256247])




```python
ary5
```




    array([       nan, 0.17480546, 0.92714985,        nan, 0.7494462 ,
           0.64813177, 1.6873242 , 1.04256247])




```python
ary6 = np.arange(8)
np.sqrt(ary6,ary6)
```


    ---------------------------------------------------------------------------

    TypeError                                 Traceback (most recent call last)

    <ipython-input-107-ddf37c2bcb22> in <module>()
          1 ary6 = np.arange(8)
    ----> 2 np.sqrt(ary6,ary6)
    

    TypeError: ufunc 'sqrt' output (typecode 'd') could not be coerced to provided output parameter (typecode 'l') according to the casting rule ''same_kind''


进行数学函数运算输出float类型，会导致out选项类型不符（原ary6为int型）

## 常用函数总结

|一元函数|方法|
|-|-:|
|abs/fabs|计算整数、浮点数、复数的绝对值，不计算复数可使用fabs运算速度较快|
|sqrt|开方|
|square|平方|
|exp |计算e幂|
|log\log10\log2\log1p|计算自然、10、2的对数和ln(1+x)|
|sign|计算各元素的正负号|
|ceil|取大于等于该数的最小数（向上取整）|
|floor|取小于等于该数的最大数（向下取整）|
|rint|四舍五入取整并保持dtype|
|isnan|返回表示哪些值是nan的bool型数组|
|isfinite\isinf|表示哪些值是有限\无限的bool数组|
|cos\cosh\sin\sinh\tan\tanh|三角函数|
|arccos\arccosh\arcsin\arcsinh\arctan\arctanh|反三角函数|

|二元函数 | 方法
|- |-
|add|对应元素相加
|subtract|对应第一个元素减对应第二个元素
|multiply|对应元素相乘
|divide\floor_divide|对应第一个元素除以对应第二个元素（【A】/【B】）或向下圆整除法（丢弃余数）
|power| 【A】^【B】
|maximum\fmax|元素级的最大值计算。fmax忽略NaN
|minimum\fmin|元素级的最小值计算。fmin忽略NaN
|mod|元素级的求模计算（除法的余数）
|copysign|将第二组数组中的值赋给第一个数组中的值
|greater\greater_equal\less\less_equal|比较运算，返回bool数组
|logical_and\logical_or\logical_xor|逻辑与、或、异或运算
